/*****GLOBAL VARIABLES*****/
baseDir = "/edcc";
geo2id = {};
id2geo = {};

geoAccList = ["GSM774238","GSM818027","GSM908949","GSM752962","GSM468801","GSM818060","GSM864800","GSM864801","GSM864802","GSM878621","GSM723025","GSM878620","GSM723023","GSM878625","GSM663427","GSM878624","GSM789281","GSM701535","GSM753425","GSM701537","GSM774216","GSM752991","GSM774210","GSM701532","GSM752993","GSM701536","GSM774219","GSM701530","GSM450268","GSM450266","GSM906387","GSM774213","GSM878649","GSM878648","GSM878643","GSM878642","GSM878641","GSM878640","GSM878647","GSM878646","GSM878645","GSM878644","GSM908954","GSM616128","GSM616129","GSM616127","GSM706067","GSM706065","GSM665801","GSM665800","GSM665803","GSM665802","GSM665805","GSM665804","GSM665807","GSM665806","GSM665808","GSM595919","GSM595918","GSM667619","GSM595913","GSM595915","GSM595914","GSM595917","GSM595916","GSM667611","GSM896162","GSM896166","GSM456941","GSM665835","GSM908939","GSM908947","GSM878629","GSM878628","GSM450270","GSM530662","GSM530663","GSM530660","GSM530661","GSM530666","GSM530664","GSM530665","GSM818029","GSM818028","GSM818021","GSM817208","GSM818023","GSM818022","GSM818025","GSM818024","GSM818026","GSM493385","GSM493384","GSM493387","GSM493386","GSM878658","GSM878659","GSM878654","GSM878655","GSM878656","GSM878657","GSM878650","GSM878651","GSM878652","GSM878653","GSM774241","GSM774243","GSM753435","GSM595930","GSM665812","GSM665813","GSM665810","GSM665811","GSM665816","GSM665817","GSM665814","GSM665815","GSM774204","GSM665818","GSM665819","GSM774202","GSM908962","GSM908960","GSM908966","GSM753439","GSM753430","GSM701541","GSM774237","GSM752963","GSM701504","GSM752968","GSM701506","GSM753434","GSM701500","GSM753432","GSM774209","GSM701502","GSM906379","GSM864803","GSM665037","GSM774201","GSM818020","GSM530657","GSM530656","GSM530655","GSM530654","GSM530653","GSM530652","GSM530651","GSM530659","GSM530658","GSM818038","GSM752967","GSM818033","GSM818030","GSM818031","GSM818036","GSM818037","GSM818034","GSM818035","GSM701509","GSM605296","GSM605297","GSM605295","GSM605298","GSM605299","GSM753974","GSM817159","GSM753446","GSM753427","GSM706081","GSM753442","GSM706083","GSM753440","GSM753449","GSM521869","GSM665827","GSM665826","GSM665825","GSM665824","GSM665823","GSM665822","GSM665821","GSM665820","GSM665829","GSM665828","GSM818013","GSM706071","GSM667609","GSM667608","GSM706075","GSM752976","GSM909314","GSM701499","GSM909312","GSM818009","GSM818008","GSM818007","GSM774206","GSM521898","GSM595929","GSM595920","GSM595922","GSM595924","GSM595926","GSM701492","GSM817172","GSM605339","GSM605338","GSM605330","GSM605333","GSM605332","GSM605335","GSM605334","GSM605337","GSM605336","GSM701496","GSM752977","GSM428289","GSM774240","GSM752971","GSM432392","GSM701510","GSM595921","GSM595923","GSM595925","GSM595927","GSM595928","GSM409307","GSM752975","GSM767348","GSM774244","GSM774233","GSM701516","GSM774231","GSM701514","GSM667618","GSM752978","GSM667612","GSM667613","GSM667610","GSM701512","GSM667616","GSM667617","GSM667614","GSM667615","GSM665838","GSM665839","GSM665830","GSM665831","GSM665832","GSM665833","GSM665834","GSM774235","GSM665836","GSM665837","GSM701519","GSM909311","GSM752972","GSM466734","GSM466737","GSM466732","GSM767343","GSM466739","GSM767341","GSM767347","GSM906390","GSM767345","GSM818010","GSM818011","GSM818012","GSM818014","GSM818015","GSM818016","GSM818017","GSM818018","GSM818019","GSM752964","GSM908959","GSM605328","GSM605329","GSM605322","GSM605323","GSM605320","GSM605321","GSM605327","GSM605324","GSM605325","GSM706072","GSM878610","GSM667629","GSM667628","GSM667627","GSM667626","GSM667625","GSM667624","GSM667623","GSM667622","GSM667621","GSM667620","GSM878613","GSM878616","GSM818039","GSM807399","GSM807398","GSM807403","GSM807402","GSM807401","GSM701489","GSM706074","GSM450236","GSM521909","GSM521904","GSM521907","GSM521906","GSM521900","GSM521903","GSM521902","GSM701539","GSM753437","GSM818061","GSM818063","GSM818062","GSM753429","GSM774228","GSM908948","GSM605319","GSM605318","GSM605317","GSM605316","GSM605315","GSM605314","GSM605312","GSM605311","GSM605310","GSM701522","GSM701520","GSM752989","GSM428291","GSM817167","GSM817166","GSM428295","GSM817160","GSM817163","GSM428296","GSM774227","GSM817169","GSM817168","GSM701528","GSM752984","GSM752986","GSM701525","GSM667630","GSM667633","GSM667634","GSM667635","GSM667636","GSM667637","GSM667638","GSM667639","GSM752980","GSM767351","GSM701521","GSM701527","GSM767353","GSM602260","GSM602261","GSM774214","GSM521918","GSM521919","GSM521917","GSM521914","GSM521915","GSM521912","GSM767355","GSM521911","GSM774217","GSM774211","GSM753428","GSM433167","GSM908941","GSM908943","GSM908945","GSM774215","GSM906382","GSM774218","GSM605300","GSM605301","GSM605302","GSM605303","GSM605304","GSM605305","GSM605306","GSM605307","GSM605308","GSM605309","GSM908956","GSM906380","GSM774212","GSM817220","GSM789284","GSM817176","GSM817177","GSM817174","GSM817175","GSM428286","GSM817173","GSM817170","GSM817171","GSM723021","GSM817178","GSM817179","GSM896165","GSM807391","GSM906408","GSM667641","GSM667640","GSM667643","GSM667642","GSM906389","GSM906381","GSM807396","GSM602259","GSM602258","GSM602257","GSM521923","GSM521922","GSM521921","GSM521927","GSM521926","GSM521925","GSM521924","GSM521929","GSM521928","GSM818049","GSM818048","GSM878633","GSM818043","GSM818042","GSM818041","GSM818040","GSM818047","GSM818046","GSM818045","GSM818044","GSM878631","GSM723024","GSM878637","GSM723022","GSM807393","GSM433179","GSM807392","GSM433174","GSM433176","GSM433177","GSM433170","GSM433171","GSM908965","GSM807395","GSM807394","GSM908938","GSM789280","GSM701534","GSM752992","GSM752990","GSM701538","GSM817213","GSM817212","GSM817211","GSM817210","GSM817217","GSM817215","GSM817214","GSM817219","GSM817218","GSM701533","GSM752981","GSM752983","GSM701531","GSM832838","GSM832839","GSM832837","GSM410808","GSM753438","GSM410807","GSM752985","GSM706079","GSM753436","GSM752966","GSM818058","GSM818054","GSM818055","GSM818056","GSM818057","GSM818050","GSM818051","GSM818052","GSM818053","GSM521908","GSM753431","GSM701503","GSM701540","GSM752987","GSM908937","GSM774207","GSM706068","GSM701505","GSM701507","GSM706066","GSM706064","GSM753433","GSM701501","GSM774208","GSM752965","GSM864035","GSM864034","GSM864037","GSM864036","GSM896161","GSM701508","GSM906388","GSM817204","GSM817205","GSM817206","GSM817207","GSM817200","GSM817201","GSM817202","GSM817203","GSM878623","GSM878622","GSM817209","GSM878627","GSM878626","GSM753973","GSM706073","GSM701493","GSM906405","GSM706080","GSM706082","GSM521899","GSM521893","GSM521892","GSM521890","GSM521894","GSM908964","GSM906401","GSM706076","GSM706078","GSM906403","GSM706077","GSM878662","GSM706070","GSM774239","GSM817216","GSM908963","GSM908961","GSM752970","GSM908967","GSM878638","GSM878639","GSM878632","GSM878630","GSM878634","GSM817165","GSM409312","GSM753441","GSM701491","GSM878611","GSM701497","GSM521884","GSM521885","GSM521886","GSM521887","GSM521880","GSM521881","GSM521883","GSM701495","GSM896164","GSM752974","GSM701517","GSM774230","GSM767349","GSM701515","GSM753445","GSM774236","GSM701513","GSM701511","GSM753448","GSM701518","GSM774232","GSM767346","GSM767344","GSM767342","GSM469965","GSM701494","GSM908958","GSM752979","GSM701498","GSM409308","GSM909313","GSM908950","GSM878635","GSM521871","GSM521870","GSM521873","GSM521875","GSM521874","GSM521877","GSM521879","GSM521878","GSM774234","GSM434776","GSM908957","GSM908955","GSM468792","GSM864799","GSM469973","GSM469971","GSM469975","GSM878612","GSM878614","GSM878615","GSM878617","GSM878618","GSM878619","GSM817164","GSM774242","GSM817161","GSM817162","GSM752982","GSM701487","GSM817187","GSM817186","GSM817185","GSM817184","GSM817183","GSM817182","GSM817181","GSM817180","GSM817189","GSM817188","GSM774229","GSM774221","GSM521930","GSM521931","GSM521866","GSM521932","GSM521868","GSM521933","GSM701523","GSM752988","GSM817191","GSM774224","GSM817195","GSM774226","GSM701529","GSM774220","GSM434762","GSM774223","GSM774222","GSM701524","GSM434785","GSM774203","GSM818059","GSM767354","GSM767356","GSM767350","GSM701526","GSM774205","GSM767352","GSM817158","GSM906391","GSM701488","GSM469966","GSM469967","GSM878665","GSM878664","GSM878667","GSM878666","GSM878661","GSM878660","GSM878663","GSM706063","GSM706062","GSM908944","GSM667631","GSM667632","GSM878636","GSM908946","GSM817198","GSM817199","GSM908940","GSM817190","GSM817192","GSM817193","GSM817194","GSM817196","GSM817197","GSM908942","GSM701490","GSM774225","GSM959044","GSM521901","GSM469970","GSM521897","GSM521895","GSM521913","GSM469974","GSM521889","GSM469968","GSM1003562","GSM935646","GSM935653","GSM945181","GSM788083","GSM733699","GSM1008558","GSM736617","GSM803542","GSM816643","GSM1010754","GSM788081","GSM1024746","GSM736615","GSM935478","GSM1003609","GSM1003530","GSM945202","GSM803505","GSM1006891","GSM935503","GSM803503","GSM1010848","GSM935423","GSM788087","GSM1003486","GSM1003531","GSM788085","GSM935509","GSM1010831","GSM736530","GSM1006886","GSM935384","GSM970217","GSM1010756","GSM803507","GSM1010839","GSM816436","GSM733733","GSM803525","GSM1010843","GSM1010812","GSM1010906","GSM945229","GSM935380","GSM1003553","GSM736578","GSM803372","GSM803508","GSM935626","GSM1010744","GSM1024741","GSM733737","GSM736612","GSM803500","GSM733735","GSM1008568","GSM1024743","GSM733725","GSM945166","GSM945160","GSM935504","GSM935620","GSM1024749","GSM945174","GSM749694","GSM803490","GSM935506","GSM935622","GSM1010887","GSM736618","GSM945162","GSM935500","GSM935624","GSM1010881","GSM749696","GSM945261","GSM935445","GSM1003574","GSM1010833","GSM782124","GSM945267","GSM1010847","GSM1010765","GSM1003455","GSM945222","GSM945858","GSM1008569","GSM935441","GSM733756","GSM945263","GSM1010791","GSM945190","GSM788088","GSM945192","GSM935326","GSM945226","GSM1006893","GSM1008560","GSM1010793","GSM822311","GSM1006876","GSM1003534","GSM788075","GSM970218","GSM1010900","GSM788073","GSM733730","GSM733660","GSM733662","GSM777637","GSM788071","GSM1010888","GSM733786","GSM935651","GSM816636","GSM816670","GSM935566","GSM788078","GSM816634","GSM749750","GSM782123","GSM733784","GSM816632","GSM935379","GSM1003532","GSM1010752","GSM1010904","GSM1003575","GSM749717","GSM1024774","GSM1010721","GSM1003556","GSM935585","GSM749711","GSM1003577","GSM733651","GSM945297","GSM733653","GSM1006877","GSM733782","GSM1024778","GSM935562","GSM733655","GSM935560","GSM1003573","GSM816672","GSM935407","GSM749757","GSM1024793","GSM935401","GSM1024770","GSM935589","GSM935403","GSM1010772","GSM1010727","GSM749715","GSM935323","GSM1010763","GSM1010861","GSM945298","GSM803345","GSM1010825","GSM1003488","GSM803347","GSM1003473","GSM1010823","GSM736574","GSM935643","GSM1010734","GSM935329","GSM1010821","GSM1003578","GSM803474","GSM1010766","GSM1003539","GSM803439","GSM935432","GSM935372","GSM1010768","GSM803472","GSM803349","GSM935370","GSM1010829","GSM1010863","GSM935580","GSM935376","GSM1010827","GSM1006866","GSM816648","GSM1010777","GSM803434","GSM803342","GSM1010868","GSM1006881","GSM1003569","GSM1010773","GSM803476","GSM935524","GSM935408","GSM1010891","GSM935521","GSM733724","GSM935640","GSM945199","GSM803430","GSM1010735","GSM1010832","GSM733726","GSM935404","GSM803340","GSM1010864","GSM1010728","GSM935406","GSM736601","GSM803527","GSM749769","GSM1008564","GSM935414","GSM1003449","GSM736603","GSM736570","GSM803350","GSM733667","GSM803471","GSM1024744","GSM1003627","GSM1008585","GSM803539","GSM1010890","GSM935527","GSM733775","GSM733702","GSM1006869","GSM935435","GSM1008587","GSM935437","GSM945179","GSM1008589","GSM733779","GSM935431","GSM1003478","GSM935272","GSM1010885","GSM935539","GSM803335","GSM935314","GSM733700","GSM736502","GSM733656","GSM803337","GSM935316","GSM1008581","GSM733658","GSM935318","GSM1008583","GSM935278","GSM945211","GSM733708","GSM803530","GSM935462","GSM803536","GSM935310","GSM945215","GSM733721","GSM803333","GSM935312","GSM803534","GSM816653","GSM733723","GSM935636","GSM803374","GSM1024739","GSM1003500","GSM935634","GSM803370","GSM1003502","GSM733729","GSM945315","GSM1010746","GSM1003504","GSM736604","GSM803532","GSM736546","GSM816655","GSM733772","GSM1003634","GSM945172","GSM935632","GSM777639","GSM935630","GSM733776","GSM736501","GSM1003498","GSM736548","GSM945170","GSM935315","GSM935457","GSM1010771","GSM803379","GSM945178","GSM945251","GSM1003631","GSM803338","GSM1003519","GSM803484","GSM945212","GSM945210","GSM1003617","GSM1024787","GSM816657","GSM935350","GSM1008594","GSM935352","GSM935277","GSM1003542","GSM935275","GSM945218","GSM818827","GSM1003484","GSM733672","GSM816644","GSM733714","GSM1008559","GSM1003544","GSM749726","GSM822295","GSM935369","GSM1003546","GSM736631","GSM736582","GSM1003514","GSM1010731","GSM822309","GSM749728","GSM736633","GSM736580","GSM935556","GSM822291","GSM935554","GSM816646","GSM803392","GSM1010739","GSM1010737","GSM803390","GSM1010732","GSM1003509","GSM1010862","GSM935411","GSM935355","GSM816649","GSM803409","GSM1010855","GSM1003461","GSM803407","GSM945288","GSM1024789","GSM803396","GSM816641","GSM935458","GSM935483","GSM1008574","GSM1003469","GSM1003622","GSM1010774","GSM935364","GSM736634","GSM935366","GSM935531","GSM945249","GSM1010778","GSM1010857","GSM935360","GSM1003463","GSM803400","GSM1008579","GSM803382","GSM935487","GSM822298","GSM945241","GSM935481","GSM1010858","GSM1024780","GSM1010740","GSM935343","GSM803443","GSM945326","GSM1010817","GSM803441","GSM803334","GSM803447","GSM1010859","GSM733752","GSM945324","GSM1008566","GSM803402","GSM1010850","GSM935416","GSM733739","GSM733677","GSM935552","GSM749779","GSM1008577","GSM733675","GSM1010813","GSM935488","GSM1008571","GSM1010811","GSM733763","GSM803529","GSM1003480","GSM733748","GSM945180","GSM822308","GSM1003581","GSM935559","GSM733769","GSM822273","GSM935306","GSM803446","GSM1003459","GSM803497","GSM1003501","GSM822275","GSM935304","GSM733716","GSM803360","GSM803524","GSM945201","GSM935287","GSM1003496","GSM803520","GSM935285","GSM945203","GSM803493","GSM803399","GSM1010856","GSM935302","GSM935410","GSM733755","GSM803371","GSM803495","GSM803522","GSM803366","GSM803415","GSM935600","GSM1003512","GSM1010761","GSM1008600","GSM1010784","GSM803362","GSM935497","GSM935283","GSM1003510","GSM935281","GSM1003608","GSM803369","GSM935608","GSM1010780","GSM733764","GSM935606","GSM1006870","GSM733766","GSM935298","GSM803411","GSM1010879","GSM733760","GSM935602","GSM733670","GSM803418","GSM935461","GSM736554","GSM1008604","GSM945187","GSM736556","GSM1010786","GSM1006874","GSM1010743","GSM945265","GSM935644","GSM945208","GSM1024766","GSM803498","GSM1003580","GSM1010747","GSM1010889","GSM777640","GSM935467","GSM803416","GSM945204","GSM935465","GSM935344","GSM803516","GSM1003605","GSM803510","GSM935342","GSM1006883","GSM1010802","GSM935340","GSM935633","GSM935395","GSM1003552","GSM1008601","GSM1010846","GSM935293","GSM736525","GSM1003550","GSM935397","GSM1006882","GSM733710","GSM733646","GSM798321","GSM803514","GSM733644","GSM803432","GSM803344","GSM1008570","GSM733706","GSM803487","GSM1008573","GSM749736","GSM733704","GSM935391","GSM733712","GSM935393","GSM935540","GSM1003554","GSM1008603","GSM1010810","GSM733687","GSM1003482","GSM733637","GSM1024750","GSM822285","GSM736621","GSM733685","GSM822287","GSM935548","GSM803513","GSM816658","GSM1010875","GSM1003586","GSM1010808","GSM935349","GSM935513","GSM736627","GSM935511","GSM1003503","GSM733683","GSM935347","GSM736625","GSM803380","GSM733681","GSM935345","GSM935517","GSM945279","GSM803368","GSM1010789","GSM1010748","GSM749733","GSM803388","GSM1003507","GSM945276","GSM1003585","GSM945182","GSM945231","GSM935398","GSM803458","GSM1010899","GSM1008602","GSM945233","GSM935468","GSM749675","GSM1010849","GSM1003471","GSM1010840","GSM1024795","GSM736542","GSM822306","GSM935495","GSM1010838","GSM1010842","GSM733709","GSM935558","GSM1010767","GSM935493","GSM1010844","GSM1003584","GSM803378","GSM822302","GSM1024762","GSM822288","GSM736564","GSM935491","GSM733744","GSM1008561","GSM1010801","GSM803457","GSM1003491","GSM935498","GSM803438","GSM803451","GSM1010803","GSM1010897","GSM1010809","GSM803453","GSM1010782","GSM822304","GSM733645","GSM816663","GSM1003453","GSM1010769","GSM1024753","GSM733643","GSM816665","GSM1010805","GSM1003495","GSM1010733","GSM733641","GSM1003457","GSM1008563","GSM1010807","GSM803455","GSM1003607","GSM935545","GSM1003630","GSM749747","GSM935592","GSM749706","GSM749745","GSM935590","GSM733638","GSM935547","GSM1006865","GSM749743","GSM1003451","GSM816437","GSM935332","GSM749748","GSM935598","GSM736568","GSM935330","GSM935549","GSM736628","GSM935291","GSM935514","GSM736596","GSM803422","GSM1010820","GSM733749","GSM803343","GSM803387","GSM935336","GSM935518","GSM733747","GSM733745","GSM816668","GSM1003513","GSM803428","GSM945159","GSM1010869","GSM803358","GSM803461","GSM935591","GSM1010794","GSM736561","GSM1003524","GSM935295","GSM935297","GSM935597","GSM736563","GSM803427","GSM1008556","GSM1008590","GSM1010759","GSM1008593","GSM935471","GSM1010877","GSM803425","GSM935473","GSM935616","GSM1003620","GSM935652","GSM1003611","GSM803486","GSM1010892","GSM803541","GSM736593","GSM935479","GSM1003612","GSM1010896","GSM1024782","GSM1010893","GSM803504","GSM1003619","GSM935610","GSM1010758","GSM935612","GSM803502","GSM935614","GSM935650","GSM935426","GSM1024757","GSM1003613","GSM1003467","GSM935385","GSM1010880","GSM1008576","GSM1008605","GSM1008575","GSM803506","GSM816628","GSM736594","GSM945302","GSM935383","GSM803540","GSM935534","GSM803509","GSM945269","GSM733691","GSM945322","GSM1003465","GSM733693","GSM1010788","GSM945304","GSM733736","GSM803501","GSM733734","GSM945306","GSM736613","GSM733698","GSM733754","GSM935575","GSM822270","GSM816627","GSM935505","GSM1003568","GSM935577","GSM733695","GSM733757","GSM1003549","GSM803437","GSM736534","GSM935579","GSM736619","GSM803341","GSM945262","GSM777644","GSM1010799","GSM1003566","GSM935571","GSM935573","GSM1003564","GSM945264","GSM935472","GSM935474","GSM945221","GSM1010750","GSM935388","GSM935476","GSM1024759","GSM1010836","GSM822312","GSM1010790","GSM945225","GSM733640","GSM1010792","GSM822310","GSM935425","GSM935628","GSM1008578","GSM749749","GSM935429","GSM1010834","GSM1003445","GSM816671","GSM749751","GSM1003499","GSM733785","GSM1003447","GSM935587","GSM749753","GSM1024776","GSM782122","GSM1010718","GSM749759","GSM803420","GSM935584","GSM1003571","GSM733783","GSM1003497","GSM733781","GSM816673","GSM1008596","GSM935508","GSM788082","GSM736616","GSM733718","GSM1006887","GSM1006873","GSM788080","GSM1024790","GSM1024747","GSM736614","GSM935588","GSM1003448","GSM935320","GSM1010886","GSM935583","GSM1010860","GSM935502","GSM749752","GSM788086","GSM1003487","GSM935328","GSM788084","GSM1003489","GSM816438","GSM736575","GSM803473","GSM945856","GSM1003538","GSM1008606","GSM935373","GSM935371","GSM803348","GSM935581","GSM736571","GSM935377","GSM1024740","GSM1003545","GSM945168","GSM1008584","GSM733717","GSM1024791","GSM945228","GSM736579","GSM803477","GSM945854","GSM736577","GSM935625","GSM935409","GSM945196","GSM1010882","GSM935627","GSM1010787","GSM945198","GSM1010865","GSM1024785","GSM935386","GSM935405","GSM803478","GSM1010729","GSM1008586","GSM945165","GSM1003603","GSM733664","GSM749693","GSM803355","GSM736567","GSM733666","GSM935621","GSM749695","GSM935623","GSM803470","GSM945163","GSM935568","GSM803538","GSM935382","GSM1010760","GSM935434","GSM1010762","GSM935436","GSM1008588","GSM1010764","GSM1024755","GSM935430","GSM1003479","GSM1024772","GSM1003604","GSM733657","GSM935459","GSM1008580","GSM935442","GSM1008582","GSM935649","GSM803533","GSM945312","GSM935325","GSM935438","GSM1003515","GSM803531","GSM945191","GSM803537","GSM1010730","GSM945310","GSM733720","GSM1003522","GSM803535","GSM736609","GSM935582","GSM788076","GSM935595","GSM1010785","GSM1010901","GSM788072","GSM945316","GSM736605","GSM733661","GSM1003632","GSM736607","GSM1010903","GSM935567","GSM788079","GSM816635","GSM935374","GSM935557","GSM816633","GSM935565","GSM733773","GSM1003493","GSM1010722","GSM733771","GSM935378","GSM733669","GSM816631","GSM935569","GSM733777","GSM945290","GSM935299","GSM945296","GSM733713","GSM1010902","GSM733650","GSM1003576","GSM935563","GSM733652","GSM935440","GSM816639","GSM935561","GSM733654","GSM816637","GSM935400","GSM935402","GSM803485","GSM945292","GSM945213","GSM803483","GSM1010826","GSM945299","GSM1003472","GSM1003526","GSM1010824","GSM1010898","GSM1010822","GSM1003579","GSM822289","GSM935433","GSM1003474","GSM935638","GSM935274","GSM1003476","GSM945295","GSM935439","GSM1003470","GSM803391","GSM736585","GSM736583","GSM1003565","GSM733727","GSM945857","GSM803398","GSM935358","GSM1003506","GSM749768","GSM1024784","GSM736600","GSM1003508","GSM736602","GSM935354","GSM935356","GSM803406","GSM733774","GSM749762","GSM1010852","GSM803404","GSM749764","GSM733778","GSM935273","GSM1003606","GSM1008565","GSM736638","GSM935526","GSM803449","GSM1010775","GSM803336","GSM935365","GSM935367","GSM935317","GSM1010770","GSM1010779","GSM935279","GSM935361","GSM1003548","GSM935319","GSM803408","GSM945216","GSM803401","GSM803480","GSM736588","GSM1003460","GSM945214","GSM803357","GSM1024781","GSM935311","GSM736586","GSM736584","GSM1008572","GSM1010816","GSM803440","GSM935635","GSM803377","GSM803405","GSM1003537","GSM935417","GSM1010851","GSM803403","GSM803444","GSM935415","GSM1003505","GSM945175","GSM803397","GSM733676","GSM749687","GSM733674","GSM777638","GSM935637","GSM803442","GSM935456","GSM935520","GSM1010757","GSM945177","GSM1010776","GSM736639","GSM733728","GSM749688","GSM945853","GSM945244","GSM733759","GSM733758","GSM935351","GSM803523","GSM736519","GSM945320","GSM935368","GSM822279","GSM1003528","GSM1003572","GSM1003543","GSM818826","GSM935282","GSM733673","GSM935280","GSM733671","GSM736516","GSM736547","GSM935553","GSM1003582","GSM935362","GSM733765","GSM733767","GSM935522","GSM733679","GSM733761","GSM733719","GSM736630","GSM1024767","GSM945286","GSM736632","GSM822290","GSM733711","GSM736557","GSM1006875","GSM935555","GSM1024769","GSM945209","GSM1010819","GSM945323","GSM803393","GSM1010738","GSM935300","GSM803499","GSM1024763","GSM945205","GSM736636","GSM777641","GSM945207","GSM945284","GSM1003462","GSM1003623","GSM1003628","GSM1010751","GSM1003625","GSM1003533","GSM1003602","GSM1003583","GSM1003468","GSM798322","GSM1003466","GSM1003535","GSM1003621","GSM945273","GSM935308","GSM935484","GSM749737","GSM935486","GSM1003520","GSM945240","GSM945242","GSM935482","GSM935289","GSM733686","GSM733751","GSM935480","GSM733684","GSM733753","GSM733665","GSM945325","GSM1003626","GSM816659","GSM733688","GSM749739","GSM733768","GSM935341","GSM749730","GSM1003616","GSM816654","GSM935348","GSM733722","GSM733682","GSM733680","GSM935489","GSM1003518","GSM816656","GSM1003521","GSM1010905","GSM736597","GSM733762","GSM1010749","GSM1006878","GSM1003516","GSM749732","GSM945185","GSM803494","GSM1008567","GSM1003570","GSM803459","GSM945183","GSM736543","GSM803496","GSM935305","GSM935399","GSM935469","GSM935309","GSM1003557","GSM1003547","GSM945206","GSM945200","GSM1010845","GSM935303","GSM935301","GSM935603","GSM803367","GSM803454","GSM1010800","GSM803456","GSM803365","GSM803414","GSM1003458","GSM803363","GSM803450","GSM736635","GSM1003511","GSM1010830","GSM1003517","GSM1010841","GSM803452","GSM803361","GSM1003452","GSM733642","GSM935642","GSM733705","GSM935335","GSM935609","GSM1003450","GSM1024794","GSM1003456","GSM1010804","GSM935375","GSM1008562","GSM1003454","GSM1010806","GSM803410","GSM935542","GSM945300","GSM935648","GSM935544","GSM945188","GSM935546","GSM1010837","GSM1010742","GSM749673","GSM945184","GSM733689","GSM1003464","GSM935645","GSM935424","GSM803429","GSM736629","GSM935466","GSM1003633","GSM935464","GSM803419","GSM825711","GSM803517","GSM935290","GSM803384","GSM803511","GSM935292","GSM803386","GSM935519","GSM935647","GSM733746","GSM935463","GSM1003551","GSM935396","GSM736560","GSM1006885","GSM733649","GSM935294","GSM733647","GSM935296","GSM803515","GSM733707","GSM1003614","GSM1003559","GSM945239","GSM935392","GSM1003555","GSM935541","GSM935543","GSM935394","GSM736622","GSM1010895","GSM733636","GSM736620","GSM822284","GSM733703","GSM1003494","GSM803512","GSM822286","GSM733701","GSM1003610","GSM1010745","GSM935619","GSM1003560","GSM736590","GSM803426","GSM803354","GSM736592","GSM803489","GSM803381","GSM736626","GSM935516","GSM945278","GSM736624","GSM803383","GSM1003618","GSM945271","GSM935611","GSM935613","GSM945321","GSM1003483","GSM945275","GSM935615","GSM803389","GSM1003629","GSM1008595","GSM945277","GSM945230","GSM935490","GSM803431","GSM945232","GSM1003529","GSM945301","GSM1010783","GSM822305","GSM935496","GSM1010781","GSM935494","GSM816629","GSM822301","GSM935338","GSM935492","GSM1003615","GSM822303","GSM1003490","GSM935499","GSM733690","GSM733743","GSM733692","GSM733741","GSM816662","GSM935574","GSM935576","GSM1003492","GSM935276","GSM733694","GSM935578","GSM733696","GSM733639","GSM1003563","GSM1003561","GSM935570","GSM1003567","GSM935529","GSM935572","GSM749740","GSM1003536","GSM935530","GSM935333","GSM935475","GSM935599","GSM935389","GSM935331","GSM935477","GSM1010753","GSM1010755","GSM1010835","GSM935594","GSM749708","GSM935307","GSM803353","GSM736599","GSM1010828","GSM935337","GSM816667","GSM803466","GSM736587","GSM935507","GSM803460","GSM803359","GSM1003527","GSM935532","GSM1010741","GSM935428","GSM935596","GSM1003525","GSM803424","GSM1010871","GSM1003523","GSM1008597","GSM803356","GSM1003444","GSM1003485","GSM1008557","GSM1003446","GSM1003481","GSM1010719","GSM935501","GSM1008591","GSM945308","GSM803469","GSM733738","GSM1010876","GSM935470","GSM1010878"];
geoFlatENCODE = {};
geoFlatROADMAP = {};

geoURLencode = 'http://vizhub.wustl.edu/public/hg19/encode.md';
geoURLroadmap = 'http://vizhub.wustl.edu/public/hg19/roadmap9_methylC.md';

expURLAssays = 'http://vizhub.wustl.edu/metadata/Experimental_assays';
donorURL     = 'http://vizhub.wustl.edu/metadata/human/Donor';
samplesURL   = 'http://vizhub.wustl.edu/metadata/human/Samples';
institutionsURL = 'http://vizhub.wustl.edu/metadata/Institutions';

//Assay
vocAssay = gflagmdlst[3];

//Sample
vocSample = gflagmdlst[1];

//Institution
vocInst = gflagmdlst[4];

/* this is what we want */
// {
//   "cell_type": 453,
//   "assay": 10,
//   "institution": 5,
//   "donorID": "7",
//   "sampleID": "SRS120882_7",
//   "species": "human",
//   "in_fullref": "0",
//   "track": [{"view": "signal", "track_name": "AN_H3K27ac_7_64", "id": 30108, "format": "bigWig", "metadata": {}}]
// },

// 1. pick sample name
// 2. pick sample id from samples JSON
// 3. Replace space with _
// 4. Query that string in cell types JSON
// 5. Pick Assay id
// 6. Query that in Assay JSON
// 7.   

/*****************************************************************************/
/* select_dataset: Event Handlers */
/*****************************************************************************/
Template.select_dataset.events({
    'submit .handle-select-datafile-submit': function (event) {
        var data = event.target.dataselect.value;
        var str = range(1, 5);
        console.log(data);
        Session.set('dataSelected', str);
        console.log('ok..will try setting the session variable to : ' + str);

        // Prevent Submit
        return false;
    },
});

/*****************************************************************************/
/* select_dataset: Helpers */
/*****************************************************************************/
Template.select_dataset.helpers({
    datapageReady: function () { 
        return Session.get('isDataGridReady')
    }
});

/*****************************************************************************/
/* select_dataset: Lifecycle Hooks */
/*****************************************************************************/
Template.select_dataset.onCreated(function () {
    Session.set('isDataGridReady', false);
    
    callAPIforGEO();
    setTimeout( callAPI('httpGETcall', geoURLencode, geoFlatENCODE ), 4000);
    // callAPI('httpGETcall', geoURLroadmap,  geoFlatROADMAP );

    setTimeout(doneLoading, 1000);
});

Template.select_dataset.onRendered(function () {


    // Load completed
    
});

Template.select_dataset.onDestroyed(function () {
    Session.set('isDataGridReady', false);
});

/*****************************************************************************/
/* select_dataset: generic functions */
/*****************************************************************************/

function range(start, end) {
    var foo = [];
    for (var i = start; i <= end; i++) {
        foo.push(i.toString());
    }
    return foo;
}


function doneLoading(){
  Session.set('isDataGridReady', true);
}


/*==============Fetch globally required data=========*/

function callAPIforGEO() {
    Meteor.call('httpGETcall', function(error, res) {
      if (!error) {
            var data = eval('(' + res + ')');
            bootstrapGEO(data);
      } else {
        console.log(error);
      }
    });
}

var sampleList =  [];

function bootstrapGEO(data) {
    /* entire set of geo */
    for(i = 0; i < data.geo.length; i++ ) {
        var v = data.geo[i];
        // geo, id, label, treatFiles, inputFiles
        geo2id[v[0]] = v[1];
        id2geo[v[0]] = {
            acc:        v[0],
            id:         v[1],
            label:      v[2],
            treatment:  v[3].split(','),
            input:(v[4].length == 0 ? null : v[4].split(','))
        };
    } /* for loop end */

    /* an entry in id2geo looks like this :- */
   /* Object
        acc: "GSM908959"
        input:null
        label:"H3K79me1 in BMP4 Trophoblast Cells"
        treatment:Array[1]
            0:"SRX135230"*/

// now get the metadata info and filter for 2088 datasets


    Meteor.call('httpGETcall', geoURLencode, function(error, res) {
      if (!error) {
            var data = eval('(' + res + ')');
            console.log("======printing encode data ======");
           
            data.forEach(function(d) {
               // console.dir(d);
                if (d.geo) {
                  var geo = d.geo[0];
                  // Re-format the objects 
                    if (geo2id[geo]) {   
                        updateid2geoObj(geo, d.metadata);
                    }
                }   
            });
            // var uniqueEncodeGEOhits = encodeGEOhits.filter(function(item, i, ar){ return ar.indexOf(item) === i; });        
      }
    
    }); /* geoURLencode end */

    Meteor.call('httpGETcall', geoURLroadmap, function(error, res) {
      if (!error) {
            var data = eval('(' + res + ')');
            data.forEach(function(d) {
                if (d.geo) {
                  var geoName = d.geo[0];
                  // Re-format the objects 
                    if (geo2id[geoName]) {
                        updateid2geoObj(geoName, d.metadata);
                    }
                }   
            });
      }
      // var uniqueSampleList = sampleList.filter(function(item, i, ar){ return ar.indexOf(item) === i; });
      // sampleListToId(uniqueSampleList);
    }); /* geoURLencode end */
} /* bootstrapGEO end */


// function sampleListToId(arr) {
//     Meteor.call('httpGETcall', samplesURL, function(error, res) {
//       if (!error) {
//             var sampleJSONparsed = eval('(' + res + ')');
//             processSampleJSON(sampleJSONparsed, arr);
//       } 
//     });  
// }


// function processSampleJSON(parsedSampleJSON, sampleList) {

//     var takeStock = [];
//     sampleList.forEach(function(a) {
//         if (parsedSampleJSON.terms[a][0]) {
//             takeStock.push(parsedSampleJSON.terms[a][0].replace(/ /g,"_"));
//         }
//     });
//     cellTypeProcess(takeStock);
// }

// function cellTypeProcess(arr) {

//     var cell_type_formatted = {};
//     d3.json('/json/cell_types.json', function(err, res) {
//         if (! err ) {
//             var cell_type_arr = res.cell_type;

//             cell_type_arr.forEach(function(d) {
//                 cell_type_formatted[d.name] = d.id;
//             });
//         } 
//         var listOfCellTypes = [];
//         arr.forEach(function(a) {
//             if (cell_type_formatted[a]) {
//                 listOfCellTypes.push(cell_type_formatted[a]);
//             } else if (cell_type_formatted[a.toLowerCase()]) {
//                 listOfCellTypes.push(cell_type_formatted[a.toLowerCase()]);
//             } 
//         });

//     extractDatasets(listOfCellTypes);
//     });
// }

// function extractDatasets(arr) {
//     d3.json('/json/roadmap_encode.json', function(err, res) {
//         if (! err ) {
//             var ihec_encode_rmJSON = res.dataset;

//             var saveList = {};
//             var toReturn = [];

//             ihec_encode_rmJSON.forEach(function(d) {
//                 saveList[d.cell_type] = d;
//             });

//             arr.forEach(function(i) {
//                 if ( saveList[i] ) {
//                     toReturn.push(saveList[i]);
//                 } 
//             });

//             // console.log(JSON.stringify(toReturn));
//         } 
//     });
// }




function callAPI(apiName, url, postProcess) {
    Meteor.call(apiName, url, function(error, res) {
      if (!error) {
            var data = eval('(' + res + ')');
            cleanUpGEO(data, postProcess);
      } else {
        console.log(error);
      }
    });
}


function cleanUpGEO(res, geoFlat) {
    res.forEach(function(d) {
        if (d.geo) {
          var geoName = d.geo[0];
          // Re-format the objects 
            var obj = {};

            obj['name'] = d.name;
            obj['detail_url'] = d.detail_url;
            obj['metadata'] = d.metadata;
            obj['type'] = d.type;
            obj['public'] = d.public;
            obj['url'] = d.url;

            // var metadata = d.name.split(' ');

            if (geoFlat[geoName]) {
              geoFlat[geoName].push(obj);
            } else {
              geoFlat[geoName] = [obj];
            }
        }   
    });
}

// var samplesJSONobj = {};
// Meteor.call('httpGETcall', samplesURL, function(error, res) {
//       if (!error) {
//             var data = eval('(' + res + ')');
//       } else {
//         console.log(error);
//       }

//     var cell_type_formatted = {};

//     d3.json('/json/cell_types.json', function(err, res) {
//         if (! err ) {
//             var cell_type_arr = res.cell_type;

//             cell_type_arr.forEach(function(d) {
                
//                 cell_type_formatted[d.name] = d.id;
                
//             });
//         } 
//     });

// // GSM605625: Array[6]
// // 0: Object
// // detail_url: "http://vizhub.wustl.edu/tD/hg19/GSM605625_2"
// // metadata: Object
// // Assay: "25002"
// // Institution: "30006"
// // Sample: "13047"

//     geoFlatENCODE.forEach(function(d) {
//         console.log(d[0].metadata.Sample);
//     });

//     // console.dir(Object.keys(samplesJSONobj.cell_type).length);
//     console.log(Object.keys(data.terms).length);
//     console.dir(cell_type_formatted);

// });

// Object.keys(geo2id).forEach(function(geo) {
    // if (geoFlatENCODE(geo)) {
    //     console.log(geoFlatENCODE[geo].metadata.Sample);
    // } else if (geoFlatROADMAP(geo)) {
    //     console.log(geoFlatROADMAP[geo].metadata.Sample);
    // }
//     console.log(geo);
// });



function mdRetrieve(term, voc) {
    var x = term;
    var lst = [];
    while (x in voc.c2p) {
        var y = undefined;
        for (y in voc.c2p[x]) {
            break;
        }
        lst.unshift(y);
        x = y;
    }
    var name = term in voc.idx2attr ? voc.idx2attr[term] : term;
    lst.push(name);

    return lst;
}


function updateid2geoObj(geo, metadata) {
    if (geoAccList.indexOf(geo) > -1) {
            var Assay = mdRetrieve(metadata.Assay, vocAssay);
            var Sample = mdRetrieve(metadata.Sample, vocSample);
            var Inst = mdRetrieve(metadata.Institution, vocInst);
            id2geo[geo]['Assay'] = Assay;
            id2geo[geo]['Sample'] = Sample;
            id2geo[geo]['Institution'] = Inst;
            id2geo[geo]['metadata'] = metadata;
            id2geo[geo]['consortium'] = 'encode';
        }  
}
