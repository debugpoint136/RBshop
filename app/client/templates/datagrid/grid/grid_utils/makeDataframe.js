geoAvailable = {"GSM935275":1,"GSM935336":1,"GSM935340":1,"GSM1010780":1,"GSM1010742":1,"GSM1010789":1,"GSM803508":1,"GSM803512":1,"GSM1010757":1,"GSM803503":1,"GSM935391":1,"GSM803380":1,"GSM935580":1,"GSM935576":1,"GSM803538":1,"GSM803388":1,"GSM803396":1,"GSM803476":1,"GSM1010775":1,"GSM803342":1,"GSM803509":1,"GSM803515":1,"GSM935486":1,"GSM935594":1,"GSM935440":1,"GSM935430":1,"GSM803483":1,"GSM935566":1,"GSM935616":1,"GSM935377":1,"GSM935517":1,"GSM935552":1,"GSM935609":1,"GSM935582":1,"GSM935595":1,"GSM935435":1,"GSM935490":1,"GSM1003567":1,"GSM1010758":1,"GSM1010732":1,"GSM1003568":1,"GSM1003569":1,"GSM935547":1,"GSM935630":1,"GSM1010871":1,"GSM1010802":1,"GSM1010850":1,"GSM935295":1,"GSM1010852":1,"GSM935553":1,"GSM935493":1,"GSM1010778":1,"GSM935622":1,"GSM935519":1,"GSM935499":1,"GSM1010878":1,"GSM1010889":1,"GSM1010777":1,"GSM1010906":1,"GSM935274":1,"GSM935301":1,"GSM1003444":1,"GSM935296":1,"GSM1003623":1,"GSM1003575":1,"GSM935378":1,"GSM935297":1,"GSM935432":1,"GSM935307":1,"GSM935502":1,"GSM1003510":1,"GSM1003473":1,"GSM1003478":1,"GSM1010719":1,"GSM1010857":1,"GSM1010760":1,"GSM1010896":1,"GSM1010808":1,"GSM1010890":1,"GSM1003574":1,"GSM935463":1,"GSM803453":1,"GSM1003582":1,"GSM803456":1,"GSM1003581":1,"GSM822289":1,"GSM1003606":1,"GSM749695":1,"GSM749769":1,"GSM749750":1,"GSM749728":1,"GSM749759":1,"GSM749736":1,"GSM749752":1,"GSM1003474":1,"GSM749748":1,"GSM1003464":1,"GSM1010774":1,"GSM749708":1,"GSM1006891":1,"GSM1006870":1,"GSM749711":1,"GSM749762":1,"GSM749740":1,"GSM749694":1,"GSM749730":1,"GSM749757":1,"GSM749764":1,"GSM733752":1,"GSM749706":1,"GSM822312":1,"GSM935611":1,"GSM1006885":1,"GSM1006869":1,"GSM1006873":1,"GSM822303":1,"GSM733672":1,"GSM803419":1,"GSM749696":1,"GSM749743":1,"GSM749732":1,"GSM749745":1,"GSM1010903":1,"GSM749726":1,"GSM749687":1,"GSM749688":1,"GSM733724":1,"GSM749753":1,"GSM749675":1,"GSM749751":1,"GSM749717":1,"GSM749737":1,"GSM749673":1,"GSM733762":1,"GSM733783":1,"GSM733716":1,"GSM749749":1,"GSM822279":1,"GSM749739":1,"GSM822285":1,"GSM733785":1,"GSM733645":1,"GSM749715":1,"GSM822287":1,"GSM803486":1,"GSM935404":1,"GSM733719":1,"GSM749733":1,"GSM822311":1,"GSM1010820":1,"GSM935407":1,"GSM1006886":1,"GSM1006874":1,"GSM1006887":1,"GSM1006882":1,"GSM822305":1,"GSM1010734":1,"GSM822309":1,"GSM1006878":1,"GSM1006875":1,"GSM822308":1,"GSM1006893":1,"GSM1003508":1,"GSM733765":1,"GSM733744":1,"GSM733636":1,"GSM749747":1,"GSM733695":1,"GSM733784":1,"GSM1006881":1,"GSM749779":1,"GSM1003633":1,"GSM749693":1,"GSM803333":1,"GSM1006883":1,"GSM803348":1,"GSM749768":1,"GSM803401":1,"GSM1003604":1,"GSM1003622":1,"GSM935484":1,"GSM935330":1,"GSM935365":1,"GSM935600":1,"GSM935400":1,"GSM1010766":1,"GSM1010899":1,"GSM935476":1,"GSM935597":1,"GSM803469":1,"GSM803386":1,"GSM935375":1,"GSM1010888":1,"GSM803434":1,"GSM1010730":1,"GSM803430":1,"GSM1010846":1,"GSM803414":1,"GSM1010844":1,"GSM1010790":1,"GSM803496":1,"GSM1010765":1,"GSM803415":1,"GSM803494":1,"GSM1010764":1,"GSM1010751":1,"GSM935345":1,"GSM935326":1,"GSM1003620":1,"GSM935590":1,"GSM935351":1,"GSM1010827":1,"GSM1010759":1,"GSM803387":1,"GSM935559":1,"GSM935562":1,"GSM935294":1,"GSM1003513":1,"GSM803542":1,"GSM935500":1,"GSM803499":1,"GSM935545":1,"GSM935494":1,"GSM1003583":1,"GSM935401":1,"GSM1010800":1,"GSM1003514":1,"GSM1010763":1,"GSM1003626":1,"GSM803495":1,"GSM803522":1,"GSM1010747":1,"GSM803422":1,"GSM803541":1,"GSM1010823":1,"GSM803539":1,"GSM803374":1,"GSM1003605":1,"GSM935621":1,"GSM1010829":1,"GSM803510":1,"GSM803442":1,"GSM1003470":1,"GSM1003522":1,"GSM1003498":1,"GSM1003524":1,"GSM1003501":1,"GSM1003484":1,"GSM1003523":1,"GSM1003518":1,"GSM1003520":1,"GSM1003487":1,"GSM1003576":1,"GSM1003532":1,"GSM1003550":1,"GSM1003489":1,"GSM1003529":1,"GSM935417":1,"GSM935615":1,"GSM935409":1,"GSM935585":1,"GSM935317":1,"GSM935355":1,"GSM935398":1,"GSM935396":1,"GSM935397":1,"GSM935438":1,"GSM803382":1,"GSM1010756":1,"GSM803439":1,"GSM1010748":1,"GSM803451":1,"GSM1010768":1,"GSM1010840":1,"GSM1010826":1,"GSM803444":1,"GSM803461":1,"GSM803432":1,"GSM803409":1,"GSM803403":1,"GSM1010856":1,"GSM1010731":1,"GSM1010769":1,"GSM1010750":1,"GSM803480":1,"GSM803353":1,"GSM1010833":1,"GSM803356":1,"GSM803424":1,"GSM1010822":1,"GSM803454":1,"GSM803343":1,"GSM803524":1,"GSM1010864":1,"GSM1010739":1,"GSM935540":1,"GSM1003608":1,"GSM935465":1,"GSM935333":1,"GSM935347":1,"GSM935373":1,"GSM803540":1,"GSM777641":1,"GSM935589":1,"GSM1010727":1,"GSM825711":1,"GSM935445":1,"GSM1010783":1,"GSM935567":1,"GSM1010738":1,"GSM803514":1,"GSM935620":1,"GSM935394":1,"GSM935581":1,"GSM935554":1,"GSM935501":1,"GSM935342":1,"GSM935343":1,"GSM935366":1,"GSM935477":1,"GSM1003618":1,"GSM1003625":1,"GSM1003448":1,"GSM803345":1,"GSM1003472":1,"GSM803493":1,"GSM803471":1,"GSM1003447":1,"GSM1010825":1,"GSM1003571":1,"GSM1003504":1,"GSM777640":1,"GSM935544":1,"GSM803460":1,"GSM935619":1,"GSM803404":1,"GSM935626":1,"GSM935442":1,"GSM935546":1,"GSM935504":1,"GSM935505":1,"GSM935549":1,"GSM935651":1,"GSM935570":1,"GSM935650":1,"GSM803390":1,"GSM935614":1,"GSM935278":1,"GSM935341":1,"GSM935364":1,"GSM935521":1,"GSM935468":1,"GSM935602":1,"GSM935467":1,"GSM935411":1,"GSM1003609":1,"GSM777638":1,"GSM777639":1,"GSM935541":1,"GSM1003634":1,"GSM803529":1,"GSM935434":1,"GSM1010847":1,"GSM935328":1,"GSM803500":1,"GSM935649":1,"GSM935569":1,"GSM1010892":1,"GSM1010901":1,"GSM1003632":1,"GSM1010718":1,"GSM935592":1,"GSM935464":1,"GSM935587":1,"GSM935415":1,"GSM935302":1,"GSM1003566":1,"GSM1003570":1,"GSM1003479":1,"GSM1003446":1,"GSM1003457":1,"GSM1003586":1,"GSM935306":1,"GSM935520":1,"GSM1003616":1,"GSM935292":1,"GSM935290":1,"GSM935305":1,"GSM935610":1,"GSM935403":1,"GSM935311":1,"GSM935298":1,"GSM1010728":1,"GSM1010807":1,"GSM935518":1,"GSM935348":1,"GSM1010898":1,"GSM1010904":1,"GSM935572":1,"GSM935318":1,"GSM935405":1,"GSM935406":1,"GSM1010865":1,"GSM935539":1,"GSM803523":1,"GSM935344":1,"GSM1010863":1,"GSM935644":1,"GSM1010835":1,"GSM935283":1,"GSM935272":1,"GSM935335":1,"GSM1003613":1,"GSM935337":1,"GSM1010740":1,"GSM803511":1,"GSM803379":1,"GSM1010834":1,"GSM803420":1,"GSM1010729":1,"GSM935431":1,"GSM935293":1,"GSM935498":1,"GSM935437":1,"GSM1003614":1,"GSM935497":1,"GSM1003631":1,"GSM1010876":1,"GSM1003607":1,"GSM822290":1,"GSM935509":1,"GSM822298":1,"GSM822286":1,"GSM935320":1,"GSM822291":1,"GSM935428":1,"GSM935466":1,"GSM935548":1,"GSM935599":1,"GSM822310":1,"GSM935410":1,"GSM935516":1,"GSM822304":1,"GSM1006866":1,"GSM1006877":1,"GSM822301":1,"GSM935491":1,"GSM935441":1,"GSM935643":1,"GSM803437":1,"GSM1003565":1,"GSM1010779":1,"GSM935652":1,"GSM935414":1,"GSM1010855":1,"GSM1010881":1,"GSM1010741":1,"GSM1010880":1,"GSM935506":1,"GSM935508":1,"GSM935433":1,"GSM935507":1,"GSM935408":1,"GSM935429":1,"GSM935480":1,"GSM935369":1,"GSM935596":1,"GSM935374":1,"GSM1010810":1,"GSM1010782":1,"GSM1010837":1,"GSM803371":1,"GSM803357":1,"GSM803358":1,"GSM803359":1,"GSM803340":1,"GSM777637":1,"GSM935309":1,"GSM935308":1,"GSM935636":1,"GSM935648":1,"GSM935361":1,"GSM1003630":1,"GSM803391":1,"GSM803362":1,"GSM803337":1,"GSM803334":1,"GSM1010755":1,"GSM803532":1,"GSM1010887":1,"GSM1003509":1,"GSM1003450":1,"GSM1010771":1,"GSM1010722":1,"GSM1010838":1,"GSM935316":1,"GSM935481":1,"GSM803361":1,"GSM803360":1,"GSM935299":1,"GSM822288":1,"GSM803536":1,"GSM935389":1,"GSM935608":1,"GSM803485":1,"GSM822270":1,"GSM935386":1,"GSM803355":1,"GSM803400":1,"GSM935287":1,"GSM803399":1,"GSM803490":1,"GSM935640":1,"GSM803487":1,"GSM935291":1,"GSM935522":1,"GSM935524":1,"GSM935530":1,"GSM935323":1,"GSM935325":1,"GSM822302":1,"GSM803484":1,"GSM803366":1,"GSM1010803":1,"GSM803474":1,"GSM935426":1,"GSM935534":1,"GSM1010737":1,"GSM733749":1,"GSM1010824":1,"GSM822306":1,"GSM935393":1,"GSM1010830":1,"GSM733759":1,"GSM935383":1,"GSM822273":1,"GSM935395":1,"GSM803533":1,"GSM935543":1,"GSM1010821":1,"GSM822284":1,"GSM803368":1,"GSM935603":1,"GSM935628":1,"GSM935312":1,"GSM935513":1,"GSM935475":1,"GSM935474":1,"GSM935388":1,"GSM935473":1,"GSM733643":1,"GSM935645":1,"GSM935402":1,"GSM803443":1,"GSM822275":1,"GSM935358":1,"GSM935632":1,"GSM803410":1,"GSM822295":1,"GSM1006865":1,"GSM1006876":1,"GSM935456":1,"GSM935588":1,"GSM935354":1,"GSM733671":1,"GSM1010788":1,"GSM935462":1,"GSM1010819":1,"GSM935461":1,"GSM1010793":1,"GSM1010817":1,"GSM803459":1,"GSM803534":1,"GSM803397":1,"GSM803438":1,"GSM935623":1,"GSM935555":1,"GSM935300":1,"GSM1010761":1,"GSM1010801":1,"GSM935332":1,"GSM803416":1,"GSM803466":1,"GSM935379":1,"GSM1010848":1,"GSM935571":1,"GSM803517":1,"GSM935647":1,"GSM935624":1,"GSM935319":1,"GSM803447":1,"GSM1010791":1,"GSM1003628":1,"GSM803497":1,"GSM1003584":1,"GSM1003449":1,"GSM935583":1,"GSM935578":1,"GSM935579":1,"GSM1003612":1,"GSM935439":1,"GSM935385":1,"GSM935392":1,"GSM935527":1,"GSM935478":1,"GSM935526":1,"GSM935285":1,"GSM935529":1,"GSM935282":1,"GSM935281":1,"GSM935531":1,"GSM935273":1,"GSM935279":1,"GSM1010749":1,"GSM1010841":1,"GSM803349":1,"GSM1010744":1,"GSM803365":1,"GSM1010804":1,"GSM1010869":1,"GSM1010754":1,"GSM803478":1,"GSM803344":1,"GSM1010784":1,"GSM803440":1,"GSM1003507":1,"GSM1010891":1,"GSM803370":1,"GSM1010792":1,"GSM1010859":1,"GSM803369":1,"GSM1010786":1,"GSM803335":1,"GSM1010735":1,"GSM803372":1,"GSM935556":1,"GSM935382":1,"GSM935560":1,"GSM935304":1,"GSM1003615":1,"GSM935565":1,"GSM1003629":1,"GSM1003563":1,"GSM935489":1,"GSM935372":1,"GSM1010893":1,"GSM803341":1,"GSM803506":1,"GSM803452":1,"GSM1010767":1,"GSM1003572":1,"GSM1003445":1,"GSM935573":1,"GSM935598":1,"GSM1003452":1,"GSM935458":1,"GSM935331":1,"GSM935289":1,"GSM1010882":1,"GSM803428":1,"GSM1010905":1,"GSM803530":1,"GSM803525":1,"GSM1010862":1,"GSM1010785":1,"GSM1010781":1,"GSM1010816":1,"GSM1003451":1,"GSM935371":1,"GSM1003560":1,"GSM1010879":1,"GSM803338":1,"GSM803405":1,"GSM803383":1,"GSM803378":1,"GSM935511":1,"GSM935633":1,"GSM935635":1,"GSM935634":1,"GSM935637":1,"GSM935638":1,"GSM935376":1,"GSM935384":1,"GSM935542":1,"GSM935310":1,"GSM1003627":1,"GSM1010813":1,"GSM803363":1,"GSM803377":1,"GSM1010902":1,"GSM803507":1,"GSM803505":1,"GSM1010776":1,"GSM1010787":1,"GSM803402":1,"GSM1010743":1,"GSM803531":1,"GSM803398":1,"GSM1010843":1,"GSM803384":1,"GSM1003617":1,"GSM935627":1,"GSM935315":1,"GSM1003603":1,"GSM935314":1,"GSM1010762":1,"GSM803350":1,"GSM803477":1,"GSM803425":1,"GSM1010851":1,"GSM803502":1,"GSM803520":1,"GSM1010839":1,"GSM935612":1,"GSM935360":1,"GSM935472":1,"GSM935471":1,"GSM935487":1,"GSM935488":1,"GSM935470":1,"GSM935469":1,"GSM935557":1,"GSM935276":1,"GSM935399":1,"GSM935457":1,"GSM935591":1,"GSM1010721":1,"GSM1010877":1,"GSM935352":1,"GSM1003573":1,"GSM1003545":1,"GSM935423":1,"GSM1010812":1,"GSM1010733":1,"GSM803537":1,"GSM803393":1,"GSM803489":1,"GSM803450":1,"GSM1010805":1,"GSM803455":1,"GSM803367":1,"GSM803431":1,"GSM1010811":1,"GSM1010770":1,"GSM1010773":1,"GSM803501":1,"GSM803407":1,"GSM935496":1,"GSM935653":1,"GSM935574":1,"GSM935575":1,"GSM935277":1,"GSM935303":1,"GSM935606":1,"GSM935280":1,"GSM935495":1,"GSM1010746":1,"GSM1010842":1,"GSM803389":1,"GSM803427":1,"GSM803336":1,"GSM1010861":1,"GSM1010900":1,"GSM1010745":1,"GSM782123":1,"GSM782124":1,"GSM816436":1,"GSM935625":1,"GSM782122":1,"GSM816438":1,"GSM816437":1,"GSM1010868":1,"GSM1010885":1,"GSM1010845":1,"GSM1010772":1,"GSM1010875":1,"GSM1010895":1,"GSM1010860":1,"GSM1010858":1,"GSM935367":1,"GSM935370":1,"GSM803408":1,"GSM1010849":1,"GSM935338":1,"GSM935642":1,"GSM803457":1,"GSM803429":1,"GSM1010828":1,"GSM1010886":1,"GSM803347":1,"GSM803426":1,"GSM1010836":1,"GSM803527":1,"GSM803441":1,"GSM1010806":1,"GSM803472":1,"GSM935558":1,"GSM935380":1,"GSM935561":1,"GSM935646":1,"GSM935356":1,"GSM1003492":1,"GSM935492":1,"GSM935425":1,"GSM1010794":1,"GSM1010753":1,"GSM935482":1,"GSM803406":1,"GSM803535":1,"GSM803516":1,"GSM803513":1,"GSM803354":1,"GSM803381":1,"GSM935368":1,"GSM803446":1,"GSM803470":1,"GSM935424":1,"GSM1010897":1,"GSM803498":1,"GSM1010832":1,"GSM803392":1,"GSM803458":1,"GSM803449":1,"GSM803418":1,"GSM803504":1,"GSM1010799":1,"GSM1010752":1,"GSM1010831":1,"GSM803473":1,"GSM1003610":1,"GSM803411":1,"GSM1010809":1,"GSM935362":1,"GSM1003611":1,"GSM935613":1,"GSM935514":1,"GSM935436":1,"GSM935568":1,"GSM935563":1,"GSM935577":1,"GSM935532":1,"GSM935329":1,"GSM935349":1,"GSM1003619":1,"GSM935459":1,"GSM935350":1,"GSM935479":1,"GSM935503":1,"GSM935584":1,"GSM1003602":1,"GSM1003621":1,"GSM935483":1,"GSM935416":1,"GSM777644":1};
makeDataframe = function() {
	
	Tracker.autorun(function() {
        var assayPins = [];
        var assayList = Session.get('acSelected');
        var samplePins = [];
        var sampleList = Session.get('tissuesSelected');
        var rowLabels = [];

        sampleList.forEach(function(s) {
	            samplePins.push(SampleRows[s]);
            	rowLabels.push(s);
        });

        assayList.forEach(function(a) {
            assayKeys[a].forEach(function(assayLeaf) {
                assayPins.push(assayLeaf);
            });
        });

        
        var dataframe = {};

        assayPins.forEach(function(assayPin) {
        	var sampleTarget = [];

        	var tmp = AssayBySample2D[assayPin];
        	samplePins.forEach(function(s) {
	        	sampleTarget.push( tmp[s] );
	        });
	        dataframe[assayPin] = sampleTarget;
        });
        
        
        var assayLabels = [];
        var formattedData = [];

        Object.keys(dataframe).forEach(function(assay, i) {
			assayLabels.push(assay);
			dataframe[assay].forEach(function(sval, j) {
				var cellObj = {}; // tmp obj
				if ( sval ) {
					var tmp = [];
					sval.forEach(function(s) {
						if ( geoAvailable[s] ){
							tmp.push(s);
						}
					});
					sval = tmp;
		            cellObj['row'] = j;
		            cellObj['col'] = i;
		            cellObj['val'] = sval.length;
		            cellObj['datasets'] = sval.join('_');
		            formattedData.push(cellObj);
				} else {
					cellObj['row'] = j;
		            cellObj['col'] = i;
		            cellObj['val'] = 0;
		            formattedData.push(cellObj);
				}
			});
		});


		var superProps = {};
		superProps.colLabel = assayLabels;
		superProps.rowLabel = rowLabels;
		superProps.data = formattedData;

		// pass.this(dataframe); // call re-draw function here

		if ( Session.get('tissuesSelected').length > 0 && 
			 Session.get('acSelected').length > 0 ) { 
			drawGrid(superProps);
		}	
    });
}
